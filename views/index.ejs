<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
    <script type="text/javascript"
src="//media.twiliocdn.com/sdk/js/client/v1.3/twilio.min.js"></script>
    <script src="https://media.twiliocdn.com/sdk/js/common/v0.1/twilio-common.min.js"></script>
    <script src="https://media.twiliocdn.com/sdk/rtc/js/ip-messaging/v0.10/twilio-ip-messaging.min.js"></script>
    <script>
      var tc = {};

      tc.accessManager = new Twilio.AccessManager('eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsImN0eSI6InR3aWxpby1mcGE7dj0xIn0.eyJqdGkiOiJTSzJiOTdhMTFjN2UzMjZiN2VkMDU4NjU0MDBhN2NiZTEwLTE0NjEzOTEwNzgiLCJncmFudHMiOnsiaWRlbnRpdHkiOiI1NzE3MGFkY2UzMTg1N2UzNWI0MjFjODciLCJpcF9tZXNzYWdpbmciOnsic2VydmljZV9zaWQiOiJJU2E4MTE5YzBlOGE4ZDQ0ZmNiZmYxODViOWU0NDQxNDk4IiwiZW5kcG9pbnRfaWQiOiJIQUFTOjU3MTcwYWRjZTMxODU3ZTM1YjQyMWM4NyJ9fSwiaWF0IjoxNDYxMzkxMDc4LCJleHAiOjE0NjEzOTQ2NzgsImlzcyI6IlNLMmI5N2ExMWM3ZTMyNmI3ZWQwNTg2NTQwMGE3Y2JlMTAiLCJzdWIiOiJBQ2JjNWVlMzYwOTQ1OTQ5MzU2ODdiZWQyY2FlNDI4NGE1In0.OBfRvIu1Xdb7R9Bt8U4tc-4u0IlRCfef7fBMZjm1S_U');
      tc.messagingClient = new Twilio.IPMessaging.Client(tc.accessManager);

      /*tc.messagingClient.getChannels().then(function(channels) {
        console.log('Channels:\n');
        for(var i = 0; i < channels.length; i++) {
          console.log('Channel: ' + channels[i].sid);
        }
      });*/

      var msg = new SpeechSynthesisUtterance();
      var voices = window.speechSynthesis.getVoices();
      msg.voice = voices[16]; // Note: some voices don't support altering params
      msg.voiceURI = 'native';
      msg.volume = 1; // 0 to 1
      msg.rate = 0.9; // 0.1 to 10
      msg.pitch = 1.7; //0 to 2
      msg.lang = 'en-US';

      tc.messagingClient.getChannelBySid('CHba0ab34d24154274a0c2af4d3b83fec8').then(function(channel) {
        channel.join().then(function(joinedChannel) {
          console.log('Joined channel ' + joinedChannel.friendlyName);
          joinedChannel.sendMessage("Find me a flight from LAX to SFO on May 15th");
        });
        channel.on('messageAdded', function(message) {
          msg.text = message.body;
          speechSynthesis.speak(msg);
        });
      });
    </script>
  </head>
  <body>
    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>
  </body>
</html>
